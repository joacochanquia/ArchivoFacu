TIMER 	EQU 	10H
PIC 	EQU 	20H
EOI 	EQU 	20H
N_CLK 	EQU 	20
N_F10	EQU	10

;vector de interrupciones
	ORG 	40
IP_F10	DW	RUT_F10
	ORG	80
IP_CLK 	DW 	RUT_CLK

;datos
	ORG 	1000H
SEG 	DB 	30H
	DB 	30H
FIN_SEG	DB 	?

;subrutinas
	ORG 	3000H
RUT_F10:PUSH	AX
	IN	AL, PIC+1
	XOR	AL, 02H
	OUT	PIC+1, AL
	MOV 	AL, EOI
	OUT 	PIC, AL
	POP 	AX
	IRET
RUT_CLK:PUSH 	AX
	INC 	SEG+1
	CMP 	SEG+1, 3AH
	JNZ 	RESET
	MOV 	SEG+1, 30H
	INC 	SEG
	CMP 	SEG, 33H
	JNZ 	RESET
	PUSH	AX
	IN	AL, PIC+1
	OR	AL, 2
	OUT	PIC+1, AL
	POP	AX
	MOV 	DL, 0FFH
RESET:	INT 	7
	MOV 	AL, 0
	OUT 	TIMER, AL
	MOV 	AL, EOI
	OUT 	PIC, AL
	POP 	AX
	IRET

;programa principal
	ORG 	2000H
	CLI
	MOV 	AL, 0FCH
	OUT 	PIC+1, AL ; PIC: registro IMR
	MOV 	AL, N_F10
	OUT 	PIC+4, AL ; PIC: registro INT0
	MOV 	AL, N_CLK
	OUT 	PIC+5, AL ; PIC: registro INT1
	MOV 	AL, 1
	OUT 	TIMER+1, AL ; TIMER: registro COMP
	MOV 	AL, 0
	OUT 	TIMER, AL ; TIMER: registro CONT
	MOV 	BX, OFFSET SEG
	MOV 	AL, OFFSET FIN_SEG-OFFSET SEG
	MOV	DL, 00H
	STI
LAZO:	CMP 	DL, 0FFH
	JNZ 	LAZO
FIN:	HLT
	END
